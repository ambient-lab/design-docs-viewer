# ドメイン定義書

## 1. 概要

本書は、システム全体で共通的に使用されるデータドメイン(データ型・桁数・バリデーションルール)を定義します。

### 1.1 目的

- データ型の標準化による品質向上
- 開発効率の向上
- 保守性の向上
- データ整合性の確保

### 1.2 適用範囲

本ドメイン定義は以下のシステムに適用されます。

- 商品管理システム
- 在庫管理システム
- 受注管理システム
- その他関連システム

## 2. ドメイン一覧

### 2.1 基本ドメイン

| ドメイン名 | データ型 | 桁数 | NULL許可 | 説明 | 使用例 |
|-----------|---------|------|---------|------|--------|
| D_ID | VARCHAR | 10 | 不可 | ID系項目 | 商品ID、顧客ID、受注ID |
| D_CODE | VARCHAR | 10 | 不可 | コード系項目 | 商品コード、部門コード |
| D_SUB_CODE | VARCHAR | 20 | 可 | サブコード系項目 | 詳細分類コード |
| D_VERSION | INTEGER | - | 不可 | バージョン番号 | 楽観的ロック用 |
| D_FLAG | CHAR | 1 | 不可 | フラグ項目 | 削除フラグ、有効フラグ |

### 2.2 名称・テキストドメイン

| ドメイン名 | データ型 | 桁数 | NULL許可 | 説明 | 使用例 |
|-----------|---------|------|---------|------|--------|
| D_NAME | VARCHAR | 100 | 不可 | 名称項目 | 商品名、顧客名 |
| D_NAME_SHORT | VARCHAR | 50 | 可 | 短縮名称 | 略称、短縮表示名 |
| D_NAME_KANA | VARCHAR | 200 | 可 | カナ名称 | 顧客名カナ、商品名カナ |
| D_TEXT | VARCHAR | 1000 | 可 | テキスト項目 | 備考、説明 |
| D_TEXT_LONG | TEXT | - | 可 | 長文テキスト | 詳細説明、コメント |
| D_DESCRIPTION | VARCHAR | 500 | 可 | 説明文 | 商品説明、注意事項 |

### 2.3 日付・時刻ドメイン

| ドメイン名 | データ型 | 桁数 | NULL許可 | 説明 | 使用例 |
|-----------|---------|------|---------|------|--------|
| D_DATE | DATE | - | 可 | 日付 | 受注日、出荷日 |
| D_DATE_REQUIRED | DATE | - | 不可 | 日付(必須) | 登録日、更新日 |
| D_DATETIME | TIMESTAMP | - | 可 | 日時 | イベント日時 |
| D_DATETIME_REQUIRED | TIMESTAMP | - | 不可 | 日時(必須) | 登録日時、更新日時 |
| D_TIME | TIME | - | 可 | 時刻 | 営業開始時刻、終了時刻 |
| D_YEAR | CHAR | 4 | 可 | 年度 | 会計年度 |
| D_MONTH | CHAR | 2 | 可 | 月 | 会計月 |

### 2.4 数値ドメイン

| ドメイン名 | データ型 | 桁数 | NULL許可 | 説明 | 使用例 |
|-----------|---------|------|---------|------|--------|
| D_AMOUNT | DECIMAL | 15,0 | 可 | 金額 | 受注金額、売上金額 |
| D_AMOUNT_REQUIRED | DECIMAL | 15,0 | 不可 | 金額(必須) | 合計金額 |
| D_PRICE | DECIMAL | 10,0 | 可 | 単価 | 商品単価 |
| D_QUANTITY | DECIMAL | 10,3 | 可 | 数量 | 受注数量、在庫数量 |
| D_QUANTITY_INT | INTEGER | - | 可 | 数量(整数) | 個数、件数 |
| D_RATE | DECIMAL | 5,2 | 可 | 率(%) | 消費税率、割引率 |
| D_PERCENTAGE | DECIMAL | 3,0 | 可 | パーセンテージ | 進捗率(0-100) |
| D_SEQUENCE | INTEGER | - | 不可 | 連番 | 明細番号、表示順 |

### 2.5 連絡先ドメイン

| ドメイン名 | データ型 | 桁数 | NULL許可 | 説明 | 使用例 |
|-----------|---------|------|---------|------|--------|
| D_EMAIL | VARCHAR | 256 | 可 | メールアドレス | 顧客メール、担当者メール |
| D_PHONE | VARCHAR | 20 | 可 | 電話番号 | 固定電話、携帯電話 |
| D_FAX | VARCHAR | 20 | 可 | FAX番号 | FAX番号 |
| D_POSTAL_CODE | VARCHAR | 8 | 可 | 郵便番号 | 郵便番号(xxx-xxxx) |
| D_ADDRESS | VARCHAR | 200 | 可 | 住所 | 都道府県+市区町村+番地 |
| D_BUILDING | VARCHAR | 100 | 可 | 建物名 | ビル名、マンション名 |

### 2.6 ユーザー・認証ドメイン

| ドメイン名 | データ型 | 桁数 | NULL許可 | 説明 | 使用例 |
|-----------|---------|------|---------|------|--------|
| D_USER_ID | VARCHAR | 20 | 不可 | ユーザーID | ログインID |
| D_PASSWORD | VARCHAR | 256 | 不可 | パスワード(ハッシュ化) | ログインパスワード |
| D_ROLE | VARCHAR | 20 | 不可 | 権限ロール | ADMIN, USER, GUEST |
| D_TOKEN | VARCHAR | 500 | 可 | 認証トークン | JWTトークン |
| D_SESSION_ID | VARCHAR | 100 | 可 | セッションID | セッション管理ID |

### 2.7 システム管理ドメイン

| ドメイン名 | データ型 | 桁数 | NULL許可 | 説明 | 使用例 |
|-----------|---------|------|---------|------|--------|
| D_DELETE_FLAG | CHAR | 1 | 不可 | 削除フラグ | 0:有効, 1:削除 |
| D_STATUS | VARCHAR | 20 | 不可 | ステータス | 処理状態、承認状態 |
| D_CREATED_BY | VARCHAR | 20 | 不可 | 登録者ID | レコード作成者 |
| D_CREATED_AT | TIMESTAMP | - | 不可 | 登録日時 | レコード作成日時 |
| D_UPDATED_BY | VARCHAR | 20 | 不可 | 更新者ID | レコード更新者 |
| D_UPDATED_AT | TIMESTAMP | - | 不可 | 更新日時 | レコード更新日時 |

## 3. バリデーションルール

### 3.1 ID・コード系

#### D_ID / D_CODE
- **形式**: 半角英数字
- **正規表現**: `^[A-Za-z0-9]{1,10}$`
- **ルール**:
  - 1文字以上10文字以内
  - 半角英数字のみ使用可能
  - 空白、記号は使用不可
  - NULL不可

#### D_SUB_CODE
- **形式**: 半角英数字・ハイフン
- **正規表現**: `^[A-Za-z0-9-]{1,20}$`
- **ルール**:
  - 1文字以上20文字以内
  - 半角英数字、ハイフン使用可能
  - NULL許可

#### D_VERSION
- **形式**: 整数
- **範囲**: 0以上
- **ルール**:
  - 0から始まる連番
  - 更新のたびにインクリメント
  - NULL不可

### 3.2 フラグ系

#### D_FLAG / D_DELETE_FLAG
- **形式**: 固定長1文字
- **値**:
  - `0`: False/無効/削除なし
  - `1`: True/有効/削除済み
- **ルール**:
  - 0または1のみ
  - デフォルト値: `0`
  - NULL不可

### 3.3 名称・テキスト系

#### D_NAME
- **形式**: 文字列
- **桁数**: 1～100文字
- **ルール**:
  - 空文字不可
  - 前後の空白は自動トリム
  - NULL不可

#### D_NAME_SHORT
- **形式**: 文字列
- **桁数**: 1～50文字
- **ルール**:
  - 空文字の場合はNULL
  - 前後の空白は自動トリム
  - NULL許可

#### D_NAME_KANA
- **形式**: 全角カタカナ
- **桁数**: 1～200文字
- **正規表現**: `^[ァ-ヶー　]+$`
- **ルール**:
  - 全角カタカナのみ
  - 長音符(ー)、中黒(・)、スペース使用可能
  - NULL許可

#### D_TEXT
- **形式**: 文字列
- **桁数**: 0～1000文字
- **ルール**:
  - 改行コード含む
  - 空文字の場合はNULL
  - NULL許可

### 3.4 日付・時刻系

#### D_DATE / D_DATE_REQUIRED
- **形式**: 日付(YYYY-MM-DD)
- **範囲**: 1900-01-01 ～ 2999-12-31
- **ルール**:
  - ISO 8601形式
  - 実在する日付のみ
  - D_DATE_REQUIREDはNULL不可

#### D_DATETIME / D_DATETIME_REQUIRED
- **形式**: 日時(YYYY-MM-DD HH:MM:SS)
- **範囲**: 1900-01-01 00:00:00 ～ 2999-12-31 23:59:59
- **ルール**:
  - ISO 8601形式
  - タイムゾーン: UTC
  - D_DATETIME_REQUIREDはNULL不可

#### D_YEAR
- **形式**: 4桁の年(YYYY)
- **正規表現**: `^[12][0-9]{3}$`
- **範囲**: 1900～2999

#### D_MONTH
- **形式**: 2桁の月(MM)
- **正規表現**: `^(0[1-9]|1[0-2])$`
- **範囲**: 01～12

### 3.5 数値系

#### D_AMOUNT / D_AMOUNT_REQUIRED
- **形式**: 数値(整数)
- **範囲**: -999,999,999,999,999 ～ 999,999,999,999,999
- **ルール**:
  - 小数点以下なし
  - 負数許可
  - D_AMOUNT_REQUIREDはNULL不可

#### D_PRICE
- **形式**: 数値(整数)
- **範囲**: 0 ～ 9,999,999,999
- **ルール**:
  - 0以上
  - 小数点以下なし

#### D_QUANTITY
- **形式**: 数値(小数点3桁)
- **範囲**: -9,999,999.999 ～ 9,999,999.999
- **ルール**:
  - 小数点以下3桁まで
  - 負数許可(返品等)

#### D_QUANTITY_INT
- **形式**: 整数
- **範囲**: -2,147,483,648 ～ 2,147,483,647
- **ルール**:
  - 整数のみ
  - 負数許可

#### D_RATE
- **形式**: 数値(小数点2桁)
- **範囲**: 0.00 ～ 100.00
- **ルール**:
  - 0以上100以下
  - 小数点以下2桁まで
  - パーセンテージ表記(例: 10.00 = 10%)

#### D_PERCENTAGE
- **形式**: 整数
- **範囲**: 0 ～ 100
- **ルール**:
  - 0以上100以下
  - 整数のみ

#### D_SEQUENCE
- **形式**: 整数
- **範囲**: 1以上
- **ルール**:
  - 1から始まる連番
  - NULL不可

### 3.6 連絡先系

#### D_EMAIL
- **形式**: メールアドレス
- **桁数**: 1～256文字
- **正規表現**: `^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$`
- **ルール**:
  - RFC 5322準拠
  - 半角英数字、記号(@.-_+%)のみ
  - @の前後に文字必須
  - ドメイン部分に.必須
  - NULL許可

#### D_PHONE / D_FAX
- **形式**: 電話番号
- **桁数**: 10～20文字
- **正規表現**: `^[0-9-+()]+$`
- **ルール**:
  - 数字、ハイフン、括弧、+記号使用可能
  - 形式例: 03-1234-5678, 090-1234-5678, +81-3-1234-5678
  - NULL許可

#### D_POSTAL_CODE
- **形式**: 郵便番号
- **桁数**: 7～8文字
- **正規表現**: `^[0-9]{3}-?[0-9]{4}$`
- **ルール**:
  - 形式: xxx-xxxx または xxxxxxx
  - 数字7桁(ハイフン含む場合8桁)
  - NULL許可

#### D_ADDRESS
- **形式**: 住所文字列
- **桁数**: 1～200文字
- **ルール**:
  - 都道府県から番地まで
  - NULL許可

#### D_BUILDING
- **形式**: 建物名文字列
- **桁数**: 1～100文字
- **ルール**:
  - ビル名、部屋番号等
  - NULL許可

### 3.7 ユーザー・認証系

#### D_USER_ID
- **形式**: 半角英数字・アンダースコア
- **桁数**: 4～20文字
- **正規表現**: `^[a-zA-Z0-9_]{4,20}$`
- **ルール**:
  - 4文字以上20文字以内
  - 半角英数字、アンダースコアのみ
  - 先頭は英字推奨
  - NULL不可

#### D_PASSWORD
- **形式**: ハッシュ化文字列
- **桁数**: 256文字
- **ルール**:
  - BCrypt等でハッシュ化された値を保存
  - 平文保存禁止
  - NULL不可

#### D_ROLE
- **形式**: 半角英大文字
- **桁数**: 1～20文字
- **値の例**:
  - `ADMIN`: 管理者
  - `USER`: 一般ユーザー
  - `GUEST`: ゲスト
- **ルール**:
  - 定義済みロールのみ
  - NULL不可

### 3.8 システム管理系

#### D_STATUS
- **形式**: 半角英大文字・アンダースコア
- **桁数**: 1～20文字
- **値の例**:
  - `DRAFT`: 下書き
  - `PENDING`: 保留中
  - `APPROVED`: 承認済
  - `REJECTED`: 却下
  - `COMPLETED`: 完了
  - `CANCELLED`: キャンセル
- **ルール**:
  - 定義済みステータスのみ
  - NULL不可

#### D_CREATED_BY / D_UPDATED_BY
- **形式**: ユーザーID(D_USER_IDと同じ)
- **桁数**: 4～20文字
- **ルール**:
  - 存在するユーザーIDを参照
  - NULL不可

#### D_CREATED_AT / D_UPDATED_AT
- **形式**: 日時(TIMESTAMP)
- **ルール**:
  - UTC形式
  - アプリケーション側で自動設定
  - NULL不可

## 4. ドメイン使用ガイドライン

### 4.1 ドメイン選択基準

| 項目種類 | 推奨ドメイン | 備考 |
|---------|------------|------|
| 主キー(ID) | D_ID | 10桁以内の識別子 |
| 外部キー | 参照先テーブルの主キードメイン | 型を一致させる |
| 名称(必須) | D_NAME | 一般的な名称項目 |
| 名称(任意) | D_NAME_SHORT | 略称や短縮名 |
| カナ名称 | D_NAME_KANA | 全角カタカナのみ |
| 備考・説明 | D_TEXT | 1000文字以内 |
| 詳細説明 | D_TEXT_LONG | 長文対応 |
| 金額 | D_AMOUNT | 15桁整数 |
| 単価 | D_PRICE | 10桁整数 |
| 数量(小数) | D_QUANTITY | 小数点3桁 |
| 数量(整数) | D_QUANTITY_INT | 整数のみ |
| 率(%) | D_RATE | 0.00～100.00 |
| 登録日時 | D_CREATED_AT | システム自動設定 |
| 更新日時 | D_UPDATED_AT | システム自動設定 |

### 4.2 NULL許可の判断基準

**NULL不可とすべき項目:**
- 主キー、外部キー
- 業務上必須の項目
- システム管理項目(登録日時、更新日時等)
- デフォルト値が設定可能な項目

**NULL許可とすべき項目:**
- 任意入力項目
- 段階的に入力される項目
- 条件付きで必要な項目

### 4.3 デフォルト値設定推奨

| ドメイン | デフォルト値 | 設定理由 |
|---------|------------|----------|
| D_DELETE_FLAG | '0' | 初期状態は削除なし |
| D_VERSION | 0 | バージョン管理の開始値 |
| D_FLAG | '0' | 初期状態は無効 |
| D_QUANTITY_INT | 0 | 数量の初期値 |
| D_CREATED_AT | CURRENT_TIMESTAMP | 自動設定 |
| D_UPDATED_AT | CURRENT_TIMESTAMP | 自動設定 |

### 4.4 バリデーション実装レベル

各バリデーションは以下のレベルで実装します。

**レベル1: データベース制約**
- NOT NULL制約
- データ型制約
- 長さ制約

**レベル2: アプリケーション(Bean Validation)**
- 形式チェック(@Pattern)
- 範囲チェック(@Min, @Max)
- 必須チェック(@NotNull, @NotBlank)
- カスタムバリデーション

**レベル3: 画面(JavaScript)**
- 入力補助
- リアルタイムフィードバック
- ユーザビリティ向上

## 5. 拡張ガイドライン

### 5.1 新規ドメイン追加

新規ドメインを追加する場合、以下の手順に従います。

1. **必要性の確認**
   - 既存ドメインで対応できないか確認
   - 複数箇所で再利用される見込みがあるか

2. **ドメイン定義**
   - ドメイン名(D_で始まる)
   - データ型、桁数
   - NULL許可/不可
   - バリデーションルール

3. **レビュー・承認**
   - アーキテクトによるレビュー
   - 本書への追記

4. **適用・周知**
   - 開発チームへの周知
   - 既存システムへの影響確認

### 5.2 ドメイン変更

既存ドメインの変更は影響範囲が大きいため、慎重に行います。

- 桁数拡張: 影響度中(データ移行不要)
- 桁数縮小: 影響度大(データ移行必要)
- 型変更: 影響度大(データ移行必要)
- バリデーション追加: 影響度中(既存データ検証必要)

## 6. 付録

### 6.1 正規表現パターン集

```regex
# ID・コード系
ID/CODE: ^[A-Za-z0-9]{1,10}$
SUB_CODE: ^[A-Za-z0-9-]{1,20}$

# 名称系
NAME_KANA: ^[ァ-ヶー　]+$

# 連絡先系
EMAIL: ^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$
PHONE: ^[0-9-+()]+$
POSTAL_CODE: ^[0-9]{3}-?[0-9]{4}$

# 日付系
YEAR: ^[12][0-9]{3}$
MONTH: ^(0[1-9]|1[0-2])$

# ユーザー系
USER_ID: ^[a-zA-Z0-9_]{4,20}$
```

### 6.2 データ型マッピング(Java - PostgreSQL)

| Javaデータ型 | PostgreSQLデータ型 | ドメイン例 |
|-------------|-------------------|-----------|
| String | VARCHAR(n) | D_ID, D_NAME, D_CODE |
| String | CHAR(n) | D_FLAG, D_DELETE_FLAG |
| String | TEXT | D_TEXT_LONG |
| LocalDate | DATE | D_DATE |
| LocalDateTime | TIMESTAMP | D_DATETIME |
| Integer | INTEGER | D_VERSION, D_QUANTITY_INT |
| BigDecimal | DECIMAL(p,s) | D_AMOUNT, D_PRICE, D_QUANTITY |

### 6.3 変更履歴

| 版数 | 変更日 | 変更者 | 変更内容 |
|-----|--------|-------|---------|
| 1.0 | 2025-11-27 | システム開発チーム | 初版作成 |

---

**文書管理情報**
- 文書ID: SPEC-COMMON-001
- 最終更新日: 2025-11-27
- 承認者: システムアーキテクト
- 次回レビュー予定: 2026-05-27
