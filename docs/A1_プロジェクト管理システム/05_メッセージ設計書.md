# メッセージ設計書

## 文書情報

| 項目 | 内容 |
|------|------|
| システム名 | A1_プロジェクト管理システム |
| 文書名 | メッセージ設計書 (Next.js/React版) |
| 作成日 | 2025-11-27 |
| バージョン | 2.0 |

## 目次

1. [概要](#概要)
2. [メッセージ管理方式](#メッセージ管理方式)
3. [メッセージID体系](#メッセージid体系)
4. [型定義とバリデーション連携](#型定義とバリデーション連携)
5. [画面メッセージ](#画面メッセージ)
6. [バッチ・APIメッセージ](#バッチapiメッセージ)
7. [実装例](#実装例)
8. [多言語対応](#多言語対応)

---

## 概要

### 目的
本文書は、Next.js/Reactベースのプロジェクト管理システムで使用する全メッセージの定義と実装方法を定めることで、型安全なメッセージ管理とユーザビリティ向上を実現することを目的とする。

### 適用範囲
- クライアントサイドメッセージ (バリデーション、情報、警告、エラー)
- サーバーサイドメッセージ (API、Server Actions、バッチ処理)
- システムメッセージ (例外処理、ログ出力)

### 技術スタック
- **Next.js 14+** (App Router)
- **i18n ライブラリ**: next-intl (推奨) または react-i18next
- **バリデーション**: Zod (型安全なスキーマ定義)
- **メッセージ管理**: TypeScript定数ファイル + JSON

---

## メッセージ管理方式

### アーキテクチャ概要

```
src/
├── messages/
│   ├── ja.ts                    # 日本語メッセージ定義 (型安全)
│   ├── en.ts                    # 英語メッセージ定義
│   ├── types.ts                 # メッセージ型定義
│   └── index.ts                 # メッセージエクスポート
├── lib/
│   ├── i18n.ts                  # next-intl設定
│   └── validation/
│       ├── schemas.ts           # Zodスキーマ定義
│       └── messages.ts          # バリデーションメッセージマッピング
└── middleware.ts                # 言語検出・ルーティング
```

### 推奨ライブラリ: next-intl

**理由:**
- Next.js App Routerネイティブサポート
- Server Components対応
- 型安全なメッセージ参照
- RSC/SSRでのパフォーマンス最適化

**代替案: react-i18next**
- クライアントサイド中心の場合
- 既存i18nextエコシステム利用時

---

## メッセージID体系

### 命名規則

```
MSG-[区分]-[連番]

区分:
  - I (Info):      情報メッセージ
  - W (Warning):   警告メッセージ
  - E (Error):     エラーメッセージ
  - V (Validation): バリデーションエラー
  - B (Business):  業務エラー
  - S (System):    システムエラー
  - API:           APIエラー
  - BATCH:         バッチメッセージ
```

### メッセージID例

| メッセージID | 分類 | 内容例 |
|-------------|------|--------|
| MSG-I-001 | 情報 | プロジェクトを登録しました |
| MSG-W-001 | 警告 | セッションがタイムアウトしました |
| MSG-E-001 | エラー | システムエラーが発生しました |
| MSG-V-001 | バリデーション | {field}は必須項目です |
| MSG-B-001 | 業務エラー | プロジェクトが見つかりません |
| MSG-S-001 | システムエラー | データベース接続エラー |
| MSG-API-001 | API | リクエストが不正です |
| MSG-BATCH-001 | バッチ | バッチ処理を開始します |

---

## 型定義とバリデーション連携

### メッセージ型定義

```typescript
// messages/types.ts
export type MessageKey = keyof typeof messages;

export type MessageParams = {
  [K in MessageKey]: typeof messages[K] extends string
    ? never
    : Parameters<typeof messages[K]>[0];
};

export interface ToastMessage {
  type: 'info' | 'success' | 'warning' | 'error';
  messageKey: MessageKey;
  params?: Record<string, string | number>;
}

export interface ValidationError {
  field: string;
  messageKey: MessageKey;
  params?: Record<string, string | number>;
}
```

### Zodバリデーションスキーマとの連携

```typescript
// lib/validation/schemas.ts
import { z } from 'zod';
import { validationMessages } from '@/messages/ja';

// カスタムエラーマップ
const customErrorMap: z.ZodErrorMap = (issue, ctx) => {
  if (issue.code === z.ZodIssueCode.too_small) {
    if (issue.minimum === 1) {
      return { message: validationMessages['MSG-V-001'] };
    }
    return { message: validationMessages['MSG-V-011'] };
  }
  if (issue.code === z.ZodIssueCode.too_big) {
    return { message: validationMessages['MSG-V-012'] };
  }
  if (issue.code === z.ZodIssueCode.invalid_string) {
    if (issue.validation === 'email') {
      return { message: validationMessages['MSG-V-042'] };
    }
    if (issue.validation === 'regex') {
      return { message: validationMessages['MSG-V-041'] };
    }
  }
  return { message: ctx.defaultError };
};

// プロジェクト登録スキーマ
export const projectSchema = z.object({
  projectCode: z
    .string()
    .min(1, { message: validationMessages['MSG-V-001'].replace('{field}', 'プロジェクトコード') })
    .length(8, { message: validationMessages['MSG-V-013'].replace('{field}', 'プロジェクトコード').replace('{length}', '8') })
    .regex(/^[a-zA-Z0-9]+$/, {
      message: validationMessages['MSG-V-041'].replace('{field}', 'プロジェクトコード')
    }),

  projectName: z
    .string()
    .min(1, { message: validationMessages['MSG-V-001'].replace('{field}', 'プロジェクト名') })
    .max(100, { message: validationMessages['MSG-V-011'].replace('{field}', 'プロジェクト名').replace('{max}', '100') }),

  startDate: z.date({
    required_error: validationMessages['MSG-V-001'].replace('{field}', '開始予定日'),
    invalid_type_error: validationMessages['MSG-V-031'].replace('{field}', '開始予定日'),
  }),

  endDate: z.date({
    required_error: validationMessages['MSG-V-001'].replace('{field}', '終了予定日'),
    invalid_type_error: validationMessages['MSG-V-031'].replace('{field}', '終了予定日'),
  }),

  budget: z
    .number({
      required_error: validationMessages['MSG-V-001'].replace('{field}', '予算'),
      invalid_type_error: validationMessages['MSG-V-021'].replace('{field}', '予算'),
    })
    .positive({ message: validationMessages['MSG-V-023'].replace('{field}', '予算') })
    .int({ message: validationMessages['MSG-V-024'].replace('{field}', '予算') }),

  email: z
    .string()
    .email({ message: validationMessages['MSG-V-042'].replace('{field}', 'メールアドレス') })
    .optional(),
}).refine(
  (data) => data.endDate >= data.startDate,
  {
    message: validationMessages['MSG-V-035'].replace('{endField}', '終了予定日').replace('{startField}', '開始予定日'),
    path: ['endDate'],
  }
);

export type ProjectFormData = z.infer<typeof projectSchema>;
```

---

## 画面メッセージ

### 情報メッセージ (Information Messages)

```typescript
// messages/ja.ts
export const infoMessages = {
  // 完了メッセージ
  'MSG-I-001': 'プロジェクトを登録しました。',
  'MSG-I-002': 'プロジェクトを更新しました。',
  'MSG-I-003': 'プロジェクトを削除しました。',
  'MSG-I-004': '{operation}が完了しました。',
  'MSG-I-005': '{entity}を{count}件{operation}しました。',

  // 確認メッセージ
  'MSG-I-011': 'プロジェクトを登録します。よろしいですか?',
  'MSG-I-012': 'プロジェクトを更新します。よろしいですか?',
  'MSG-I-013': 'プロジェクトを削除します。よろしいですか?',
  'MSG-I-014': '入力内容が保存されていません。破棄してもよろしいですか?',
  'MSG-I-015': '{entity}({count}件)を{operation}します。よろしいですか?',

  // 案内メッセージ
  'MSG-I-021': '検索条件を入力して、検索ボタンを押してください。',
  'MSG-I-022': '検索結果が0件です。',
  'MSG-I-023': '検索結果が{max}件を超えています。検索条件を絞り込んでください。',
  'MSG-I-024': '{total}件中{displayed}件を表示しています。',
  'MSG-I-025': 'ダウンロードを開始しました。',
} as const;
```

### 警告メッセージ (Warning Messages)

```typescript
export const warningMessages = {
  'MSG-W-001': '{field}は推奨値({recommended})を超えています。',
  'MSG-W-002': 'この操作は取り消せません。実行してもよろしいですか?',
  'MSG-W-003': 'セッションがタイムアウトしました。ログイン画面に戻ります。',
  'MSG-W-004': 'ファイルサイズが{size}MBを超えています。アップロードに時間がかかる場合があります。',
  'MSG-W-005': '未保存の変更があります。',
} as const;
```

### エラーメッセージ (Error Messages)

```typescript
export const errorMessages = {
  // システムエラー
  'MSG-E-001': 'システムエラーが発生しました。管理者に連絡してください。',
  'MSG-E-002': 'データベースエラーが発生しました。管理者に連絡してください。',
  'MSG-E-003': 'ファイルの読み込みに失敗しました。',
  'MSG-E-004': 'ファイルの書き込みに失敗しました。',
  'MSG-E-005': 'タイムアウトエラーが発生しました。再度実行してください。',
  'MSG-E-006': 'ネットワークエラーが発生しました。接続を確認してください。',
} as const;
```

### バリデーションメッセージ (Validation Messages)

```typescript
export const validationMessages = {
  // 必須チェック
  'MSG-V-001': '{field}は必須項目です。',
  'MSG-V-002': '{field}を選択してください。',

  // 文字列長チェック
  'MSG-V-011': '{field}は{max}文字以内で入力してください。',
  'MSG-V-012': '{field}は{min}文字以上{max}文字以内で入力してください。',
  'MSG-V-013': '{field}は{length}文字で入力してください。',

  // 数値チェック
  'MSG-V-021': '{field}は数値で入力してください。',
  'MSG-V-022': '{field}は{min}以上{max}以下で入力してください。',
  'MSG-V-023': '{field}は正の数で入力してください。',
  'MSG-V-024': '{field}は整数で入力してください。',
  'MSG-V-025': '{field}は小数点以下{digits}桁以内で入力してください。',

  // 日付チェック
  'MSG-V-031': '{field}は日付形式(yyyy/MM/dd)で入力してください。',
  'MSG-V-032': '{field}は{baseDate}以降の日付を入力してください。',
  'MSG-V-033': '{field}は{baseDate}より前の日付を入力してください。',
  'MSG-V-034': '{field}は{startDate}から{endDate}の範囲で入力してください。',
  'MSG-V-035': '{endField}は{startField}以降の日付を入力してください。',
  'MSG-V-036': '{field}に存在しない日付が入力されています。',

  // フォーマットチェック
  'MSG-V-041': '{field}は半角英数字で入力してください。',
  'MSG-V-042': '{field}はメールアドレス形式で入力してください。',
  'MSG-V-043': '{field}は電話番号形式で入力してください。',
  'MSG-V-044': '{field}は郵便番号形式(###-####)で入力してください。',
  'MSG-V-045': '{field}の形式が正しくありません。',
  'MSG-V-046': '{field}は半角カタカナで入力してください。',
  'MSG-V-047': '{field}は全角で入力してください。',

  // 相関チェック
  'MSG-V-051': '{field1}と{field2}が一致しません。',
  'MSG-V-052': '{field}が重複しています。',
  'MSG-V-053': '{field1}または{field2}のいずれかを入力してください。',
  'MSG-V-054': '{field1}と{field2}は同時に入力できません。',
} as const;
```

### 業務エラーメッセージ (Business Error Messages)

```typescript
export const businessMessages = {
  // データ存在チェック
  'MSG-B-001': '{entity}が見つかりません。',
  'MSG-B-002': '指定された{entity}は既に削除されています。',
  'MSG-B-003': '{entity}は既に登録されています。',
  'MSG-B-004': '{entity}({key})が見つかりません。',

  // 排他制御エラー
  'MSG-B-011': '{entity}は他のユーザーにより更新されています。画面を再表示して、最新の情報を確認してください。',
  'MSG-B-012': '{entity}は現在使用中です。しばらく待ってから再度実行してください。',

  // 状態チェックエラー
  'MSG-B-021': '{entity}が{status}のため、{operation}できません。',
  'MSG-B-022': '{entity}が終了しているため、更新できません。',
  'MSG-B-023': '進行中のプロジェクトが存在するため、削除できません。',

  // 権限エラー
  'MSG-B-031': 'この操作を実行する権限がありません。',
  'MSG-B-032': '{entity}の{operation}権限がありません。',
  'MSG-B-033': '参照のみ可能なユーザーです。更新はできません。',

  // 業務ルールエラー
  'MSG-B-041': 'プロジェクトメンバーが登録されていません。',
  'MSG-B-042': 'プロジェクトリーダーは必ず1名登録してください。',
  'MSG-B-043': '予算を超過しています。予算:{budget}円、合計金額:{total}円',
  'MSG-B-044': '{field}の合計が100%を超えています。',
  'MSG-B-045': '開始予定日より前の日付は登録できません。',
} as const;
```

---

## バッチ・APIメッセージ

### APIエラーメッセージ

```typescript
export const apiMessages = {
  // リクエストエラー
  'MSG-API-001': 'リクエストが不正です。',
  'MSG-API-002': '認証エラーが発生しました。',
  'MSG-API-003': 'アクセス権限がありません。',
  'MSG-API-004': 'リソースが見つかりません。',
  'MSG-API-005': 'リクエストがタイムアウトしました。',

  // サーバーエラー
  'MSG-API-011': 'サーバーエラーが発生しました。',
  'MSG-API-012': 'サービスが一時的に利用できません。',
  'MSG-API-013': 'レート制限を超えました。しばらく待ってから再試行してください。',
} as const;
```

### バッチメッセージ

```typescript
export const batchMessages = {
  // 開始・終了
  'MSG-BATCH-001': '{batchName}を開始します。',
  'MSG-BATCH-002': '{batchName}が正常に終了しました。',
  'MSG-BATCH-003': '{batchName}が異常終了しました。',
  'MSG-BATCH-004': '{batchName}の処理時間: {duration}秒',
  'MSG-BATCH-005': '{batchName}の処理をスキップします。理由: {reason}',

  // ファイル処理
  'MSG-BATCH-011': 'ファイル読み込み開始: {filePath}',
  'MSG-BATCH-012': 'ファイル読み込み完了: {count}件',
  'MSG-BATCH-013': 'ファイル出力開始: {filePath}',
  'MSG-BATCH-014': 'ファイル出力完了: {count}件',

  // 処理件数
  'MSG-BATCH-021': '処理対象件数: {count}件',
  'MSG-BATCH-022': '処理済み件数: {count}件',
  'MSG-BATCH-023': '正常処理件数: {count}件',
  'MSG-BATCH-024': 'エラー件数: {count}件',
  'MSG-BATCH-025': 'スキップ件数: {count}件',
  'MSG-BATCH-026': '進捗: {processed}/{total}件 ({percentage}%)',

  // データ処理
  'MSG-BATCH-031': '{entity}を登録しました。ID: {id}',
  'MSG-BATCH-032': '{entity}を更新しました。ID: {id}',
  'MSG-BATCH-033': '{entity}を削除しました。ID: {id}',

  // エラー
  'MSG-BATCH-E-001': 'ファイルが見つかりません: {filePath}',
  'MSG-BATCH-E-002': 'ファイルの読み込みに失敗しました: {filePath}',
  'MSG-BATCH-E-003': 'データ処理エラー: {line}行目 - {error}',
  'MSG-BATCH-E-004': '{entity}が見つかりません。ID: {id}',
} as const;
```

---

## 実装例

### 1. next-intl セットアップ

#### インストール

```bash
npm install next-intl
```

#### 設定ファイル

```typescript
// i18n.ts
import { getRequestConfig } from 'next-intl/server';
import { notFound } from 'next/navigation';

const locales = ['ja', 'en'] as const;
export type Locale = (typeof locales)[number];

export default getRequestConfig(async ({ locale }) => {
  if (!locales.includes(locale as Locale)) notFound();

  return {
    messages: (await import(`./messages/${locale}.ts`)).default,
  };
});
```

#### ミドルウェア

```typescript
// middleware.ts
import createMiddleware from 'next-intl/middleware';

export default createMiddleware({
  locales: ['ja', 'en'],
  defaultLocale: 'ja',
  localePrefix: 'as-needed',
});

export const config = {
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)'],
};
```

### 2. メッセージ定義ファイル

```typescript
// messages/ja.ts
export default {
  validation: {
    'MSG-V-001': '{field}は必須項目です。',
    'MSG-V-011': '{field}は{max}文字以内で入力してください。',
    'MSG-V-021': '{field}は数値で入力してください。',
    'MSG-V-031': '{field}は日付形式(yyyy/MM/dd)で入力してください。',
    'MSG-V-041': '{field}は半角英数字で入力してください。',
    'MSG-V-042': '{field}はメールアドレス形式で入力してください。',
  },
  info: {
    'MSG-I-001': 'プロジェクトを登録しました。',
    'MSG-I-002': 'プロジェクトを更新しました。',
    'MSG-I-003': 'プロジェクトを削除しました。',
    'MSG-I-011': 'プロジェクトを登録します。よろしいですか?',
  },
  business: {
    'MSG-B-001': '{entity}が見つかりません。',
    'MSG-B-003': '{entity}は既に登録されています。',
    'MSG-B-011': '{entity}は他のユーザーにより更新されています。画面を再表示して、最新の情報を確認してください。',
  },
  error: {
    'MSG-E-001': 'システムエラーが発生しました。管理者に連絡してください。',
    'MSG-E-002': 'データベースエラーが発生しました。管理者に連絡してください。',
  },
} as const;
```

```typescript
// messages/en.ts
export default {
  validation: {
    'MSG-V-001': '{field} is required.',
    'MSG-V-011': '{field} must be {max} characters or less.',
    'MSG-V-021': '{field} must be a number.',
    'MSG-V-031': '{field} must be in date format (yyyy/MM/dd).',
    'MSG-V-041': '{field} must be alphanumeric.',
    'MSG-V-042': '{field} must be in email format.',
  },
  info: {
    'MSG-I-001': 'Project has been registered.',
    'MSG-I-002': 'Project has been updated.',
    'MSG-I-003': 'Project has been deleted.',
    'MSG-I-011': 'Register project. Are you sure?',
  },
  business: {
    'MSG-B-001': '{entity} not found.',
    'MSG-B-003': '{entity} already exists.',
    'MSG-B-011': '{entity} has been updated by another user. Please refresh the screen.',
  },
  error: {
    'MSG-E-001': 'System error occurred. Please contact administrator.',
    'MSG-E-002': 'Database error occurred. Please contact administrator.',
  },
} as const;
```

### 3. Server Component での使用

```typescript
// app/[locale]/projects/page.tsx
import { useTranslations } from 'next-intl';

export default function ProjectsPage() {
  const t = useTranslations('info');

  return (
    <div>
      <h1>{t('MSG-I-001')}</h1>
      {/* プロジェクトを登録しました。 */}
    </div>
  );
}
```

### 4. Client Component での使用

```typescript
'use client';

import { useTranslations } from 'next-intl';
import { toast } from 'sonner';

export function ProjectForm() {
  const t = useTranslations('info');
  const tValidation = useTranslations('validation');

  const handleSubmit = async () => {
    try {
      await registerProject();
      toast.success(t('MSG-I-001'));
    } catch (error) {
      toast.error(tValidation('MSG-V-001', { field: 'プロジェクトコード' }));
    }
  };

  return <form onSubmit={handleSubmit}>...</form>;
}
```

### 5. Zodバリデーションとの統合

```typescript
// lib/validation/project-schema.ts
import { z } from 'zod';
import { getTranslations } from 'next-intl/server';

export async function createProjectSchema(locale: string) {
  const t = await getTranslations({ locale, namespace: 'validation' });

  return z.object({
    projectCode: z
      .string()
      .min(1, t('MSG-V-001', { field: 'プロジェクトコード' }))
      .length(8, t('MSG-V-013', { field: 'プロジェクトコード', length: '8' }))
      .regex(/^[a-zA-Z0-9]+$/, t('MSG-V-041', { field: 'プロジェクトコード' })),

    projectName: z
      .string()
      .min(1, t('MSG-V-001', { field: 'プロジェクト名' }))
      .max(100, t('MSG-V-011', { field: 'プロジェクト名', max: '100' })),

    budget: z
      .number({ invalid_type_error: t('MSG-V-021', { field: '予算' }) })
      .positive(t('MSG-V-023', { field: '予算' }))
      .int(t('MSG-V-024', { field: '予算' })),
  });
}
```

### 6. Server Actions での使用

```typescript
// app/actions/project-actions.ts
'use server';

import { revalidatePath } from 'next/cache';
import { getTranslations } from 'next-intl/server';
import { createProjectSchema } from '@/lib/validation/project-schema';

export async function createProject(formData: FormData) {
  const locale = formData.get('locale') as string || 'ja';
  const t = await getTranslations({ locale, namespace: 'info' });
  const tBusiness = await getTranslations({ locale, namespace: 'business' });

  try {
    const schema = await createProjectSchema(locale);
    const validatedData = schema.parse({
      projectCode: formData.get('projectCode'),
      projectName: formData.get('projectName'),
      budget: Number(formData.get('budget')),
    });

    // プロジェクト登録処理
    const project = await db.project.create({ data: validatedData });

    revalidatePath('/projects');

    return {
      success: true,
      message: t('MSG-I-001'),
    };
  } catch (error) {
    if (error instanceof z.ZodError) {
      return {
        success: false,
        errors: error.errors,
      };
    }

    if (error.code === 'P2002') { // Prisma unique constraint error
      return {
        success: false,
        message: tBusiness('MSG-B-003', { entity: 'プロジェクトコード' }),
      };
    }

    return {
      success: false,
      message: 'MSG-E-001',
    };
  }
}
```

### 7. React Hook Form との統合

```typescript
'use client';

import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useTranslations } from 'next-intl';
import { z } from 'zod';

function ProjectFormClient() {
  const t = useTranslations('validation');

  // クライアントサイドスキーマ定義
  const schema = z.object({
    projectCode: z
      .string()
      .min(1, t('MSG-V-001', { field: 'プロジェクトコード' }))
      .length(8, t('MSG-V-013', { field: 'プロジェクトコード', length: '8' })),

    projectName: z
      .string()
      .min(1, t('MSG-V-001', { field: 'プロジェクト名' }))
      .max(100, t('MSG-V-011', { field: 'プロジェクト名', max: '100' })),
  });

  const form = useForm({
    resolver: zodResolver(schema),
    defaultValues: {
      projectCode: '',
      projectName: '',
    },
  });

  return (
    <form onSubmit={form.handleSubmit(onSubmit)}>
      <input {...form.register('projectCode')} />
      {form.formState.errors.projectCode && (
        <p className="text-red-500">{form.formState.errors.projectCode.message}</p>
      )}
    </form>
  );
}
```

### 8. トースト通知との連携

```typescript
// components/toast-provider.tsx
'use client';

import { Toaster } from 'sonner';
import { useTranslations } from 'next-intl';

export function ToastProvider() {
  return <Toaster position="top-right" />;
}

// 使用例
'use client';

import { toast } from 'sonner';
import { useTranslations } from 'next-intl';

export function ActionButton() {
  const t = useTranslations('info');

  const handleAction = async () => {
    try {
      await someAction();
      toast.success(t('MSG-I-001')); // プロジェクトを登録しました
    } catch (error) {
      toast.error(t('MSG-E-001')); // システムエラーが発生しました
    }
  };

  return <button onClick={handleAction}>実行</button>;
}
```

### 9. エラーバウンダリでの使用

```typescript
// app/[locale]/error.tsx
'use client';

import { useEffect } from 'react';
import { useTranslations } from 'next-intl';

export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  const t = useTranslations('error');

  useEffect(() => {
    console.error(error);
  }, [error]);

  return (
    <div className="flex flex-col items-center justify-center min-h-screen">
      <h2 className="text-2xl font-bold mb-4">{t('MSG-E-001')}</h2>
      <button onClick={reset}>再試行</button>
    </div>
  );
}
```

### 10. APIルートハンドラでの使用

```typescript
// app/api/projects/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { getTranslations } from 'next-intl/server';

export async function POST(request: NextRequest) {
  const locale = request.headers.get('Accept-Language')?.split(',')[0] || 'ja';
  const t = await getTranslations({ locale, namespace: 'api' });

  try {
    const body = await request.json();

    // 処理
    const project = await createProject(body);

    return NextResponse.json({
      success: true,
      data: project,
      message: t('MSG-I-001'),
    });
  } catch (error) {
    return NextResponse.json(
      {
        success: false,
        message: t('MSG-API-001'),
      },
      { status: 400 }
    );
  }
}
```

---

## 多言語対応

### サポート言語

| 言語コード | 言語名 | メッセージファイル |
|----------|--------|-----------------|
| ja | 日本語 | messages/ja.ts |
| en | 英語 | messages/en.ts |

### 言語切り替え実装

```typescript
// components/language-switcher.tsx
'use client';

import { useRouter, usePathname } from 'next/navigation';
import { useLocale } from 'next-intl';

export function LanguageSwitcher() {
  const router = useRouter();
  const pathname = usePathname();
  const currentLocale = useLocale();

  const switchLanguage = (locale: string) => {
    const newPathname = pathname.replace(`/${currentLocale}`, `/${locale}`);
    router.push(newPathname);
  };

  return (
    <select
      value={currentLocale}
      onChange={(e) => switchLanguage(e.target.value)}
      className="border rounded px-2 py-1"
    >
      <option value="ja">日本語</option>
      <option value="en">English</option>
    </select>
  );
}
```

### 日付・数値のローカライゼーション

```typescript
import { useFormatter } from 'next-intl';

export function FormattedData() {
  const format = useFormatter();

  const date = new Date('2025-11-27');
  const number = 1234567.89;
  const currency = 1000000;

  return (
    <div>
      {/* 日付: 2025/11/27 (ja), 11/27/2025 (en) */}
      <p>{format.dateTime(date, { dateStyle: 'short' })}</p>

      {/* 数値: 1,234,567.89 */}
      <p>{format.number(number)}</p>

      {/* 通貨: ¥1,000,000 (ja), $1,000,000 (en) */}
      <p>{format.number(currency, { style: 'currency', currency: 'JPY' })}</p>
    </div>
  );
}
```

---

## パフォーマンス最適化

### メッセージの遅延読み込み

```typescript
// 必要な名前空間のみ読み込み
import { useTranslations } from 'next-intl';

export function ValidationMessages() {
  // validation名前空間のみ読み込み
  const t = useTranslations('validation');

  return <p>{t('MSG-V-001')}</p>;
}
```

### 型安全性の確保

```typescript
// messages/types.ts
import type ja from './ja';

export type Messages = typeof ja;

declare global {
  interface IntlMessages extends Messages {}
}
```

### TypeScript設定

```typescript
// next.config.js
const withNextIntl = require('next-intl/plugin')('./i18n.ts');

module.exports = withNextIntl({
  // Next.js設定
});
```

---

## テスト

### メッセージのユニットテスト

```typescript
// __tests__/messages.test.ts
import { describe, it, expect } from 'vitest';
import ja from '@/messages/ja';
import en from '@/messages/en';

describe('Messages', () => {
  it('should have same keys in all languages', () => {
    const jaKeys = Object.keys(ja.validation);
    const enKeys = Object.keys(en.validation);

    expect(jaKeys).toEqual(enKeys);
  });

  it('should have no missing placeholders', () => {
    Object.entries(ja.validation).forEach(([key, message]) => {
      const jaPlaceholders = message.match(/\{(\w+)\}/g) || [];
      const enPlaceholders = en.validation[key].match(/\{(\w+)\}/g) || [];

      expect(jaPlaceholders.sort()).toEqual(enPlaceholders.sort());
    });
  });
});
```

---

## ベストプラクティス

### 1. メッセージID命名規則の徹底

- 一貫性のあるプレフィックス使用 (MSG-V-, MSG-I- など)
- 3桁の連番で管理
- カテゴリごとに範囲を分割

### 2. パラメータの明確化

```typescript
// Good: 明確なパラメータ名
t('MSG-V-011', { field: 'プロジェクト名', max: 100 })

// Bad: 不明確なパラメータ
t('MSG-V-011', { 0: 'プロジェクト名', 1: 100 })
```

### 3. 型安全性の確保

```typescript
// TypeScript型定義を活用
type MessageKey = keyof typeof messages.validation;

function showValidationError(key: MessageKey, params: Record<string, string>) {
  return t(key, params);
}
```

### 4. メッセージの再利用性

```typescript
// 汎用的なメッセージを定義
'MSG-V-001': '{field}は必須項目です。'

// 使用時にパラメータで項目名を指定
t('MSG-V-001', { field: 'プロジェクトコード' })
t('MSG-V-001', { field: 'プロジェクト名' })
```

### 5. サーバーコンポーネントでの最適化

```typescript
// Server Component: getTranslations使用
import { getTranslations } from 'next-intl/server';

export async function ServerComponent() {
  const t = await getTranslations('validation');
  return <div>{t('MSG-V-001')}</div>;
}

// Client Component: useTranslations使用
'use client';
import { useTranslations } from 'next-intl';

export function ClientComponent() {
  const t = useTranslations('validation');
  return <div>{t('MSG-V-001')}</div>;
}
```

---

## 改訂履歴

| バージョン | 改訂日 | 改訂内容 | 改訂者 |
|-----------|--------|---------|--------|
| 1.0 | 2025-11-27 | 初版作成 (Spring版) | - |
| 2.0 | 2025-11-27 | Next.js/React版に全面改訂 | - |

---

## 承認

| 役割 | 氏名 | 承認日 | 署名 |
|-----|------|--------|------|
| 作成者 | | | |
| レビュアー | | | |
| 承認者 | | | |

---

**文書END**
