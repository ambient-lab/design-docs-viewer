# ソースコードから抽出可能な項目

## 1. 概要

本ドキュメントでは、ソースコードの静的解析により抽出可能な設計情報を整理します。

---

## 2. 高精度で抽出可能な項目

### 2.1 プロジェクト構造

| 抽出項目 | 抽出方法 | 精度 |
|---------|---------|------|
| モジュール構成 | pom.xml 解析 | 100% |
| パッケージ構造 | ディレクトリ走査 | 100% |
| 依存ライブラリ | pom.xml dependencies | 100% |
| フレームワーク | アノテーション検出 | 95% |

**検出例**:
```
spring-sample-project/
├── parent/     ← pom.xml <packaging>pom</packaging>
├── common/     ← pom.xml <artifactId>common</artifactId>
├── web/        ← @SpringBootApplication検出
├── api/        ← @RestController検出
└── batch/      ← @EnableBatchProcessing検出
```

### 2.2 Web画面情報

| 抽出項目 | 抽出方法 | 精度 |
|---------|---------|------|
| 画面URL | @RequestMapping, @GetMapping | 100% |
| HTTPメソッド | @GetMapping, @PostMapping | 100% |
| コントローラークラス | @Controller アノテーション | 100% |
| フォームクラス | @ModelAttribute 引数 | 95% |
| フォームフィールド | Formクラスのフィールド | 100% |

**検出例**:
```java
@Controller
@RequestMapping("/project/search")  // ← URL検出
public class ProjectSearchController {

    @GetMapping  // ← HTTPメソッド検出
    public String index(
        @ModelAttribute ProjectSearchForm form  // ← フォーム検出
    ) { ... }
}
```

### 2.3 REST API情報

| 抽出項目 | 抽出方法 | 精度 |
|---------|---------|------|
| エンドポイント | @RequestMapping値 | 100% |
| HTTPメソッド | @GetMapping等 | 100% |
| リクエスト型 | @RequestBody 引数型 | 100% |
| レスポンス型 | 戻り値型 | 95% |
| パスパラメータ | @PathVariable | 100% |

**検出例**:
```java
@RestController
@RequestMapping("/clients")  // ← ベースパス検出
public class ClientSearchController {

    @GetMapping  // ← GET /clients
    public ClientSearchResponse search(
        @Valid ClientSearchRequest request  // ← リクエスト型検出
    ) { ... }
}
```

### 2.4 バッチジョブ情報

| 抽出項目 | 抽出方法 | 精度 |
|---------|---------|------|
| ジョブ名/ID | @Configuration クラス名 | 90% |
| 処理タイプ | Step定義内容（chunk/tasklet） | 95% |
| ItemReader | @Bean定義 | 100% |
| ItemProcessor | @Bean定義 | 100% |
| ItemWriter | @Bean定義 | 100% |
| スキップ例外 | skip-limit設定 | 90% |

**検出例**:
```java
@Configuration
public class ImportProjectsConfig {  // ← ジョブ名推測

    @Bean
    public Step importProjectsStep() {
        return stepBuilder
            .<InputDto, OutputDto>chunk(100)  // ← チャンク検出
            .reader(reader)     // ← Reader検出
            .processor(processor)  // ← Processor検出
            .writer(writer)     // ← Writer検出
            .build();
    }
}
```

### 2.5 データモデル情報

| 抽出項目 | 抽出方法 | 精度 |
|---------|---------|------|
| テーブル名 | Entityクラス/@Table | 95% |
| カラム名 | フィールド名/@Column | 95% |
| データ型 | Javaフィールド型 | 90% |
| 主キー | @Id アノテーション | 100% |
| 外部キー | @JoinColumn, Mapper SQL | 85% |
| シーケンス | @GeneratedValue | 100% |

**検出例**:
```java
public class Project {
    private Integer projectId;      // ← PK推測
    private String projectName;     // ← VARCHAR推測
    private LocalDate startDate;    // ← DATE推測
    private Long versionNo;         // ← 楽観ロック推測
}
```

### 2.6 バリデーション情報

| 抽出項目 | 抽出方法 | 精度 |
|---------|---------|------|
| 必須チェック | @Required, @NotNull | 100% |
| 文字列長 | @Size, @Length | 100% |
| 数値範囲 | @Min, @Max | 100% |
| 形式チェック | @Pattern, @Email | 100% |
| ドメイン定義 | @Domain アノテーション | 90% |
| 相関チェック | @AssertTrue メソッド | 95% |

**検出例**:
```java
public class ProjectCreateForm {

    @Required  // ← 必須検出
    @Domain("projectName")  // ← ドメイン検出
    private String projectName;

    @AssertTrue(message = "...")  // ← 相関チェック検出
    public boolean isStartDateBeforeEndDate() {
        return startDate.isBefore(endDate);
    }
}
```

---

## 3. 中程度の精度で抽出可能な項目

### 3.1 画面遷移

| 抽出項目 | 抽出方法 | 精度 |
|---------|---------|------|
| 遷移先 | return "redirect:..." | 70% |
| 前画面 | Referer推測 | 50% |
| 遷移条件 | if文解析 | 40% |

**検出例**:
```java
@PostMapping("/execute")
public String execute(...) {
    return "redirect:/project/search";  // ← 遷移先検出
}
```

### 3.2 エラーハンドリング

| 抽出項目 | 抽出方法 | 精度 |
|---------|---------|------|
| 例外クラス | throws, catch | 80% |
| HTTPステータス | @ResponseStatus | 90% |
| エラーハンドラ | @ExceptionHandler | 95% |
| エラーメッセージ | 文字列リテラル | 30% |

**検出例**:
```java
@ExceptionHandler(DataNotFoundException.class)
@ResponseStatus(HttpStatus.NOT_FOUND)  // ← ステータス検出
public ErrorResponse handleNotFound(DataNotFoundException e) {
    return new ErrorResponse("NOT_FOUND", e.getMessage());
}
```

### 3.3 トランザクション境界

| 抽出項目 | 抽出方法 | 精度 |
|---------|---------|------|
| トランザクション範囲 | @Transactional | 90% |
| 伝播属性 | propagation設定 | 100% |
| 読み取り専用 | readOnly設定 | 100% |
| ロールバック条件 | rollbackFor設定 | 100% |

---

## 4. 抽出可能情報のカバレッジ

### 4.1 設計書種別ごとのカバレッジ

```
システム概要書    ████████████████████░░░░░  80%
画面設計書       ██████████████░░░░░░░░░░░  55%
API設計書        ████████████████████░░░░░  80%
バッチ設計書      ████████████████░░░░░░░░░  65%
データモデル設計書  ██████████████████░░░░░░░  75%
バリデーション設計書 ████████████████░░░░░░░░░  65%
テスト設計書      ████████░░░░░░░░░░░░░░░░░  35%
```

### 4.2 詳細カバレッジ

| 設計項目 | カバレッジ | 備考 |
|---------|-----------|------|
| クラス図 | 95% | 完全抽出可能 |
| シーケンス図 | 30% | メソッド呼び出しのみ |
| ER図 | 85% | FK関係は推測 |
| 状態遷移図 | 20% | 列挙型からの推測のみ |
| 業務フロー | 5% | コメントからの推測のみ |

---

## 5. 抽出精度向上のヒント

### 5.1 コーディング規約の遵守

以下の規約に従ったコードは抽出精度が向上します:

1. **命名規則**: クラス名、メソッド名から役割が明確
2. **アノテーション**: 適切なメタデータ付与
3. **Javadoc**: 目的と仕様の明記
4. **パッケージ構成**: 責務に基づいた分類

### 5.2 推奨アノテーション

```java
// 推奨: 明示的なアノテーション
@Table(name = "PROJECT")
@Entity
public class Project {
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name = "PROJECT_ID")
    private Integer projectId;
}

// 非推奨: 暗黙的な設定
public class Project {
    private Integer projectId;  // テーブル名・カラム名が不明確
}
```

---

## 6. まとめ

### 6.1 高精度抽出可能（90%以上）

- モジュール構成
- エンドポイント一覧
- HTTPメソッド
- クラス構造
- フィールド定義
- 単項目バリデーション

### 6.2 中精度抽出可能（60-90%）

- 画面遷移
- FK関係
- 相関チェック
- エラーハンドリング

### 6.3 低精度抽出（60%未満）

- 業務ロジックの意図
- エラーメッセージ
- 非機能要件
- 運用情報

