# バリデーション設計書（ソースコード自動生成）

> **注記**: 本ドキュメントはソースコードの静的解析により自動生成されました。

---

## 1. バリデーション方式

### 1.1 採用フレームワーク

| レイヤー | 方式 | 検出根拠 |
|---------|------|----------|
| フォーム | Nablarch Domain Validation | @Domain アノテーション |
| フォーム | Jakarta Validation | @NotNull, @Size 等 |
| 相関チェック | カスタム制約 | @AssertTrue メソッド |
| DB制約 | MyBatis | Mapper XML/エンティティ |

### 1.2 ドメイン定義

DomainBean により定義されたドメイン（推測）:

| ドメイン名 | 用途 | 制約 |
|-----------|------|------|
| projectId | プロジェクトID | 整数 |
| organizationId | 組織ID | 整数 |
| clientId | 顧客ID | 整数 |
| projectName | プロジェクト名 | 文字列、最大128文字 |
| projectType | プロジェクト種別 | コード値 |
| projectClass | プロジェクト分類 | コード値 |
| userName | ユーザー名 | 文字列、最大128文字 |
| amountOfMoney | 金額 | 整数 |
| note | 備考 | 文字列、最大512文字 |
| pageNumber | ページ番号 | 正整数 |

---

## 2. フォーム別バリデーション

### 2.1 ProjectSearchForm（プロジェクト検索）

| フィールド | ドメイン | 必須 | 単項目チェック |
|-----------|---------|------|----------------|
| divisionId | organizationId | - | 整数 |
| organizationId | organizationId | - | 整数 |
| projectTypes | projectType | - | 配列、コード値 |
| projectClasses | projectClass | - | 配列、コード値 |
| projectName | projectName | - | 最大128文字 |
| salesFrom | amountOfMoney | - | 整数 |
| salesTo | amountOfMoney | - | 整数 |
| projectStartDateFrom | - | - | 日付形式 |
| projectStartDateTo | - | - | 日付形式 |
| projectEndDateFrom | - | - | 日付形式 |
| projectEndDateTo | - | - | 日付形式 |
| pageNumber | pageNumber | - | 正整数 |

**相関チェック:**

| メソッド | チェック内容 |
|---------|-------------|
| isSalesFromLessThanSalesTo() | 売上From ≤ 売上To |
| isStartDateFromBeforeToDate() | 開始日From ≤ 開始日To |
| isEndDateFromBeforeToDate() | 終了日From ≤ 終了日To |

### 2.2 ProjectCreateForm（プロジェクト登録）

| フィールド | ドメイン | 必須 | 単項目チェック |
|-----------|---------|------|----------------|
| projectName | projectName | ○ | 最大128文字 |
| projectType | projectType | ○ | コードマスタ存在 |
| projectClass | projectClass | ○ | コードマスタ存在 |
| projectStartDate | - | ○ | 日付形式 |
| projectEndDate | - | ○ | 日付形式 |
| divisionId | organizationId | ○ | 組織マスタ存在 |
| organizationId | organizationId | ○ | 組織マスタ存在 |
| clientId | clientId | ○ | 顧客マスタ存在 |
| projectManager | userName | ○ | 最大128文字 |
| projectLeader | userName | ○ | 最大128文字 |
| note | note | - | 最大512文字 |
| sales | amountOfMoney | - | 整数 |

**相関チェック:**

| メソッド | チェック内容 |
|---------|-------------|
| isStartDateBeforeEndDate() | 開始日 ≤ 終了日 |

### 2.3 ProjectUpdateForm（プロジェクト更新）

ProjectCreateFormと同様、追加フィールド:

| フィールド | ドメイン | 必須 | 備考 |
|-----------|---------|------|------|
| projectId | projectId | ○ | 更新対象ID |
| versionNo | - | ○ | 楽観ロック |

### 2.4 ProjectUploadForm（アップロード）

| フィールド | 型 | 必須 | チェック |
|-----------|-----|------|----------|
| file | MultipartFile | ○ | ファイル形式 |

### 2.5 ProjectDownloadForm（ダウンロード）

ProjectSearchFormと同様の構成

---

## 3. API バリデーション

### 3.1 ClientCreationRequest

| フィールド | 型 | 必須 | バリデーション |
|-----------|-----|------|-----------------|
| clientName | String | ○ | 最大128文字 |
| kanaName | String | ○ | カタカナ、最大128文字 |
| industryCode | String | ○ | コードマスタ存在 |

### 3.2 ClientUpdateRequest

ClientCreationRequestと同様

### 3.3 ClientSearchRequest

| フィールド | 型 | 必須 | バリデーション |
|-----------|-----|------|-----------------|
| clientName | String | - | 部分一致用 |
| industryCode | String | - | コードマスタ存在 |

---

## 4. バッチ バリデーション

### 4.1 ImportProjectsItemProcessor

| チェック項目 | 内容 |
|-------------|------|
| 必須チェック | プロジェクト名、種別、分類等 |
| 形式チェック | 日付、数値 |
| マスタ存在 | 組織、顧客 |

### 4.2 スキップ例外

| 例外クラス | 発生条件 |
|-----------|----------|
| ValidationException | バリデーションエラー |
| FlatFileParseException | ファイル解析エラー |
| BatchSkipItemException | 業務スキップ |

---

## 5. カスタムバリデーター

### 5.1 検出されたバリデーター

| クラス | 対象 | 検証内容 |
|--------|------|----------|
| CodeExistenceValidator | コード値 | コードマスタ存在確認 |
| DateRangeValidator | 日付範囲 | From ≤ To |
| (その他) | - | ソースから検出 |

### 5.2 ドメインバリデーション

Nablarchのドメインバリデーション機構により、@Domainアノテーションで指定されたドメインに対応するバリデーションルールが自動適用される。

```
@Domain("projectName")
private String projectName;
```

→ DomainBeanで定義された「projectName」ドメインのバリデーションルールが適用

---

## 6. エラーメッセージ

### 6.1 メッセージ管理

| ファイル | 用途 |
|---------|------|
| messages.properties | 標準メッセージ |
| ValidationMessages.properties | バリデーションメッセージ |

### 6.2 メッセージ形式（推測）

```
{0}は必須です。
{0}は{1}文字以内で入力してください。
{0}は{1}以上{2}以下で入力してください。
開始日は終了日以前を指定してください。
```

---

## 7. バリデーション実行タイミング

### 7.1 Web画面

```
リクエスト受信
  ↓
@Validated による単項目チェック
  ↓
@AssertTrue による相関チェック
  ↓
Service層での業務チェック
  ↓
DB制約チェック
```

### 7.2 REST API

```
リクエスト受信
  ↓
@RequestBody + @Valid
  ↓
GlobalExceptionHandler でエラーハンドリング
  ↓
Service層での業務チェック
```

### 7.3 バッチ

```
ファイル読み込み
  ↓
ItemProcessor でバリデーション
  ↓
ValidationException → スキップ
  ↓
正常データのみ ItemWriter へ
```

