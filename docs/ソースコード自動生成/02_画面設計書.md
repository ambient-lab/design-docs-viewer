# 画面設計書（ソースコード自動生成）

> **注記**: 本ドキュメントはソースコードの静的解析により自動生成されました。

---

## 1. 画面一覧

### 1.1 コントローラーから抽出した画面

| 画面ID | 画面名 | URL | HTTPメソッド | コントローラー |
|--------|--------|-----|-------------|---------------|
| W001 | トップ | `/` | GET | TopController |
| W002 | ログイン | `/security/login` | GET, POST | SecurityLoginController |
| W003 | プロジェクト検索 | `/project/search` | GET | ProjectSearchController |
| W004 | プロジェクト検索実行 | `/project/search/search` | GET | ProjectSearchController |
| W005 | プロジェクト登録 | `/project/create` | GET | ProjectCreateController |
| W006 | プロジェクト登録確認 | `/project/create/confirm` | POST | ProjectCreateController |
| W007 | プロジェクト登録実行 | `/project/create/execute` | POST | ProjectCreateController |
| W008 | プロジェクト詳細 | `/project/detail` | GET | ProjectDetailController |
| W009 | プロジェクト更新 | `/project/update` | GET | ProjectUpdateController |
| W010 | プロジェクト更新確認 | `/project/update/confirm` | POST | ProjectUpdateController |
| W011 | プロジェクト更新実行 | `/project/update/execute` | POST | ProjectUpdateController |
| W012 | プロジェクトダウンロード | `/project/download` | GET | ProjectDownloadController |
| W013 | プロジェクトダウンロード実行 | `/project/download/download` | GET | ProjectDownloadController |
| W014 | プロジェクトアップロード | `/project/upload` | GET | ProjectUploadController |
| W015 | プロジェクトアップロード実行 | `/project/upload/execute` | POST | ProjectUploadController |

---

## 2. 画面遷移図

```
┌─────────┐     ┌─────────────┐
│  ログイン  │────▶│    トップ    │
└─────────┘     └──────┬──────┘
                       │
        ┌──────────────┼──────────────┐
        ▼              ▼              ▼
┌───────────────┐┌───────────────┐┌───────────────┐
│プロジェクト検索 ││プロジェクト登録 ││プロジェクトDL  │
└───────┬───────┘└───────┬───────┘└───────────────┘
        │              │
        ▼              ▼
┌───────────────┐┌───────────────┐
│プロジェクト詳細 ││  登録確認     │
└───────┬───────┘└───────┬───────┘
        │              │
        ▼              ▼
┌───────────────┐┌───────────────┐
│プロジェクト更新 ││  登録完了     │
└───────┬───────┘└───────────────┘
        │
        ▼
┌───────────────┐
│  更新確認     │
└───────┬───────┘
        │
        ▼
┌───────────────┐
│  更新完了     │
└───────────────┘
```

---

## 3. フォーム定義

### 3.1 ProjectSearchForm（プロジェクト検索）

| フィールド名 | 型 | ドメイン | 必須 | バリデーション |
|-------------|-----|---------|------|---------------|
| divisionId | Integer | organizationId | - | ドメイン検証 |
| organizationId | Integer | organizationId | - | ドメイン検証 |
| projectTypes | String[] | projectType | - | 配列ドメイン検証 |
| projectClasses | String[] | projectClass | - | 配列ドメイン検証 |
| projectName | String | projectName | - | ドメイン検証 |
| salesFrom | Integer | amountOfMoney | - | 数値、salesTo以下 |
| salesTo | Integer | amountOfMoney | - | 数値、salesFrom以上 |
| projectStartDateFrom | LocalDate | - | - | 日付形式 |
| projectStartDateTo | LocalDate | - | - | 日付形式、From以降 |
| projectEndDateFrom | LocalDate | - | - | 日付形式 |
| projectEndDateTo | LocalDate | - | - | 日付形式、From以降 |
| pageNumber | Integer | pageNumber | - | ページ番号 |

**相関チェック:**
- `isSalesFromLessThanSalesTo()`: 売上From ≤ 売上To
- `isStartDateFromBeforeToDate()`: 開始日From ≤ 開始日To
- `isEndDateFromBeforeToDate()`: 終了日From ≤ 終了日To

### 3.2 ProjectCreateForm（プロジェクト登録）

| フィールド名 | 型 | ドメイン | 必須 | バリデーション |
|-------------|-----|---------|------|---------------|
| projectName | String | projectName | ○ | 最大128文字 |
| projectType | String | projectType | ○ | コードマスタ |
| projectClass | String | projectClass | ○ | コードマスタ |
| projectStartDate | LocalDate | - | ○ | 日付形式 |
| projectEndDate | LocalDate | - | ○ | 日付形式 |
| divisionId | Integer | organizationId | ○ | 組織ID |
| organizationId | Integer | organizationId | ○ | 組織ID |
| clientId | Integer | clientId | ○ | 顧客ID |
| projectManager | String | userName | ○ | 最大128文字 |
| projectLeader | String | userName | ○ | 最大128文字 |
| note | String | note | - | 最大512文字 |
| sales | Integer | amountOfMoney | - | 金額 |

### 3.3 ProjectUpdateForm（プロジェクト更新）

ProjectCreateFormと同様のフィールド構成に加え、以下を含む:

| フィールド名 | 型 | 説明 |
|-------------|-----|------|
| projectId | Integer | プロジェクトID（更新対象） |
| versionNo | Long | 楽観ロック用バージョン |

### 3.4 ProjectUploadForm（プロジェクトアップロード）

| フィールド名 | 型 | 説明 |
|-------------|-----|------|
| file | MultipartFile | CSVファイル |

### 3.5 ProjectDownloadForm（プロジェクトダウンロード）

検索条件フォーム（ProjectSearchFormと類似）

---

## 4. サービスクラス

### 4.1 ProjectSearchService

| メソッド | 戻り値 | 説明 |
|---------|--------|------|
| selectProjectes(criteria) | List<ProjectDto> | プロジェクト検索 |
| selectAllDivision() | List<OrganizationDto> | 事業部一覧取得 |
| selectAllDepartment() | List<OrganizationDto> | 部門一覧取得 |

### 4.2 ProjectCreateService

| メソッド | 戻り値 | 説明 |
|---------|--------|------|
| insertProject(projectDto) | void | プロジェクト登録 |

### 4.3 ProjectDetailService

| メソッド | 戻り値 | 説明 |
|---------|--------|------|
| selectProject(projectId) | ProjectDto | プロジェクト詳細取得 |
| selectProjectForUpdate(projectId) | ProjectDto | 更新用プロジェクト取得 |

### 4.4 ProjectUpdateService

| メソッド | 戻り値 | 説明 |
|---------|--------|------|
| updateProject(projectDto) | void | プロジェクト更新 |
| lockProject(projectId, versionNo) | void | 楽観ロック |

### 4.5 ProjectDownloadService

| メソッド | 戻り値 | 説明 |
|---------|--------|------|
| selectProjectsForDownload(criteria) | List<ProjectDto> | ダウンロード用データ取得 |

---

## 5. ビューヘルパー

| クラス | 役割 |
|--------|------|
| ProjectCreateViewHelper | 登録画面のマスタデータ準備 |
| ProjectDetailViewHelper | 詳細画面のデータ準備 |
| ProjectUpdateViewHelper | 更新画面のデータ準備 |
| CodeViewHelper | コードマスタのプルダウン生成 |
| PagingViewHelper | ページネーション生成 |

---

## 6. セッション管理

### 6.1 @SessionAttributes使用

| コントローラー | セッション属性 |
|---------------|---------------|
| ProjectCreateController | projectCreateForm |
| ProjectUpdateController | projectUpdateForm |

### 6.2 トランザクショントークン

| 画面遷移 | トークンチェック |
|---------|----------------|
| 登録入力→確認 | BEGIN |
| 確認→実行 | IN |
| 更新入力→確認 | BEGIN |
| 確認→実行 | IN |
