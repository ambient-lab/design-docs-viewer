# バッチ設計書（ソースコード自動生成）

> **注記**: 本ドキュメントはソースコードの静的解析により自動生成されました。

---

## 1. バッチジョブ一覧

| ジョブID | ジョブ名 | 処理タイプ | 設定クラス |
|---------|---------|-----------|-----------|
| BA1060201 | プロジェクトワーク取込 | チャンク | ImportProjectsToWorkConfig |
| BA1060202 | プロジェクト取込 | チャンク | ImportProjectsConfig |
| BA1050101 | ユーザープロジェクト作成 | チャンク | CreateUsersProjectsConfig |
| BA1060301 | プロジェクト期間出力 | チャンク | ExportProjectsInPeriodConfig |
| BA1070101 | 業務日付更新 | タスクレット | UpdateBusinessDateConfig |

---

## 2. ジョブ詳細

### 2.1 BA1060201: プロジェクトワーク取込

**概要:** 外部ファイルからプロジェクトデータをワークテーブルに取り込む

**処理フロー:**
```
入力ファイル → ItemReader → ItemProcessor → ItemWriter → PROJECT_WORK
```

**コンポーネント:**

| コンポーネント | クラス | 説明 |
|---------------|--------|------|
| Step | ImportProjectsToWorkStep | ステップ定義 |
| ItemProcessor | ImportProjectsToWorkItemProcessor | データ変換・検証 |
| ItemWriter | - | ワークテーブル書き込み |

**設定ファイル:** `ImportProjectsToWork.properties`

---

### 2.2 BA1060202: プロジェクト取込

**概要:** ワークテーブルからプロジェクトマスタへデータを取り込む

**処理フロー:**
```
PROJECT_WORK → ItemReader → ItemProcessor → ItemWriter → PROJECT
```

**コンポーネント:**

| コンポーネント | クラス | 説明 |
|---------------|--------|------|
| ItemReader | MyBatisCursorItemReader | ワークテーブル読み込み |
| ItemProcessor | ImportProjectsItemProcessor | バリデーション・変換 |
| ItemWriter | ImportProjectsItemWriter | プロジェクト登録 |

**スキップ処理:**
- ValidationException
- FlatFileParseException
- BatchSkipItemException

**設定ファイル:** `ImportProjects.properties`

---

### 2.3 BA1050101: ユーザープロジェクト作成

**概要:** プロジェクトとユーザーの紐付けデータを生成

**処理フロー:**
```
PROJECT + USERS → ItemReader → ItemProcessor → ItemWriter → CSV出力
```

**コンポーネント:**

| コンポーネント | クラス | 説明 |
|---------------|--------|------|
| ItemProcessor | CreateUsersProjectsItemProcessor | 紐付けロジック |
| ItemWriter | - | CSV出力 |
| FieldExtractor | CreateUsersProjectsFieldExtractor | 出力項目抽出 |
| Listener | CreateUserProjectsStepExecutionListener | 前後処理 |

**設定ファイル:** `CreateUsersProjects.properties`

---

### 2.4 BA1060301: プロジェクト期間出力

**概要:** 指定期間のプロジェクトデータをCSV出力

**処理フロー:**
```
PROJECT (期間条件) → ItemReader → ItemProcessor → ItemWriter → CSV出力
```

**コンポーネント:**

| コンポーネント | クラス | 説明 |
|---------------|--------|------|
| ItemProcessor | ExportProjectsInPeriodItemProcessor | データ加工 |
| FieldExtractor | ExportProjectsInPeriodFieldExtractor | 出力項目抽出 |

**設定ファイル:** `ExportProjectsInPeriod.properties`

---

### 2.5 BA1070101: 業務日付更新

**概要:** システムの業務日付を更新する

**処理タイプ:** タスクレット（単発処理）

**コンポーネント:**

| コンポーネント | クラス | 説明 |
|---------------|--------|------|
| Tasklet | UpdateBusinessDateTasklet | 日付更新処理 |
| Mapper | UpdateBusinessDateMapper | DB更新 |

**対象テーブル:** BUSINESS_DATE

**設定ファイル:** `UpdateBusinessDate.properties`

---

## 3. 共通コンポーネント

### 3.1 基盤設定

| クラス | 説明 |
|--------|------|
| BatchBaseConfig | ジョブリポジトリ、トランザクションマネージャ |
| BatchConfig | 共通Bean定義 |

### 3.2 リスナー

| クラス | 説明 |
|--------|------|
| LoggingCountChunkListener | チャンク処理件数ログ出力 |
| LoggingCountJobListener | ジョブ統計ログ出力 |
| LoggingSkipItemListener | スキップ項目ログ出力 |
| TruncateTableListener | テーブル初期化 |

### 3.3 ユーティリティ

| クラス | 説明 |
|--------|------|
| LineNumberMapper | 行番号付与 |
| BatchExitCodeGenerator | 終了コード生成 |
| JsrJobParametersConverter | パラメータ変換 |
| BatchCommonMapper | 共通DB操作 |

---

## 4. 例外処理

### 4.1 例外クラス

| クラス | 説明 |
|--------|------|
| BatchSkipItemException | スキップ対象項目 |
| BatchSystemException | システムエラー |

### 4.2 スキップ設定

```
skip-limit: [設定値]
skippable-exceptions:
  - ValidationException
  - FlatFileParseException
  - BatchSkipItemException
```

---

## 5. 常駐バッチ

### 5.1 概要

ResidentBatchScheduler による定期実行バッチ

### 5.2 コンポーネント

| クラス | 説明 |
|--------|------|
| ResidentBatchScheduler | スケジューラ |
| ResidentBatchProcessor | 処理インターフェース |
| ResidentBatchProcessorImpl | 処理実装 |
| ResidentBatchConfig | 設定 |
| ResidentBatchService | サービス |
| ResidentBatchMapper | データアクセス |

---

## 6. 設定プロパティ

### 6.1 プロパティファイル

```
classpath:/properties/project/ImportProjects.properties
classpath:/properties/project/ImportProjectsToWork.properties
classpath:/properties/project/CreateUsersProjects.properties
classpath:/properties/project/ExportProjectsInPeriod.properties
classpath:/properties/project/UpdateBusinessDate.properties
```

### 6.2 主要プロパティ

| プロパティ | 説明 |
|-----------|------|
| chunk-size | チャンクサイズ |
| skip-limit | スキップ上限 |
| input-file | 入力ファイルパス |
| output-file | 出力ファイルパス |
